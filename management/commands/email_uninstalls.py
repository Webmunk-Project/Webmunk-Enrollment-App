# pylint: disable=no-member,line-too-long

from __future__ import print_function

import datetime
import json

import arrow
import requests

from django.conf import settings
from django.core.mail import send_mail, EmailMultiAlternatives
from django.core.management.base import BaseCommand
from django.template.loader import render_to_string
from django.urls import reverse
from django.utils import timezone

from ...models import Enrollment

class Command(BaseCommand):
    help = 'Sends reminders to participants with outstanding tasks.'

    def add_arguments(self, parser):
        pass

    def handle(self, *args, **options): # pylint: disable=too-many-locals
        from enrollment.models import Enrollment

        test_ids = ['98650795']

        ids = [
            '31691939',
            '34556133',
            '34388957',
            '17042697',
            '40983178',
            '28482366',
            '42127794',
            '22586402',
            '39226376',
            '25227322',
            '49127118',
            '85662910',
            '77817202',
            '74168445',
            '95580639',
            '90243928',
            '47363766',
            '66883379',
            '79888561',
            '61551336',
            '92831916',
            '39952161',
            '95210396',
            '28596063',
            '35368219',
            '13627926',
            '16503053',
            '28239970',
            '96734504',
            '40736739',
            '72530999',
            '85925915',
            '75837160',
            '65347054',
            '24612429',
            '51678443',
            '77480295',
            '59993236',
            '10522008',
            '80507686',
            '32443765',
            '21002922',
            '80157804',
            '96676049',
            '19527459',
            '13031925',
            '87191541',
            '65430249',
            '25751533',
            '16781756',
            '71610470',
            '83113633',
            '30661562',
            '96964433',
            '79118818',
            '58610411',
            '71114295',
            '15185168',
            '92868608',
            '56940878',
            '88369711',
            '91620203',
            '94847337',
            '17243957',
            '70045339',
            '56840818',
            '34135872',
            '30458798',
            '14738001',
            '59220935',
            '91309110',
            '89884357',
            '79306026',
            '27618884',
            '36570727',
            '31181141',
            '92331535',
            '52911466',
            '69655669',
            '80553156',
            '84215463',
            '35710409',
            '33259931',
            '53104360',
            '99956874',
            '30575615',
            '86040174',
            '93290128',
            '20430880',
            '92842906',
            '29636361',
            '25276846',
            '17058489',
            '64365490',
            '40103120',
            '26422792',
            '58559237',
            '87478725',
            '86203674',
            '28782111',
            '81508224',
            '11284338',
            '64161029',
            '91928703',
            '25458657',
            '94022640',
            '59076175',
            '59452686',
            '83286338',
            '14675454',
            '74046767',
            '79431129',
            '19711214',
            '97369862',
            '26597622',
            '11872342',
            '39585704',
            '26400395',
            '10520312',
            '65570005',
            '66700105',
            '58262396',
            '44244301',
            '98879513',
            '36869256',
            '22836979',
            '33630120',
            '72395443',
            '71717952',
            '82029539',
            '80553460',
            '61533263',
            '70145368',
            '11788883',
            '15452444',
            '34198855',
            '75162288',
            '19290540',
            '22952995',
            '32025325',
            '24770931',
            '66362129',
            '72054633',
            '74500161',
            '53452135',
            '23562982',
            '42534482',
            '56222437',
            '30039708',
            '28631296',
            '93412117',
            '64384122',
            '87535843',
            '12790698',
            '81836574',
            '89744704',
            '30613286',
            '79455821',
            '80279567',
            '96907028',
            '52862445',
            '95750543',
            '36926774',
            '16938820',
            '72765263',
            '53662954',
            '57499381',
            '37687450',
            '43268577',
            '99414177',
            '58799573',
            '45955036',
            '98650795',
            '86695070',
            '92112372',
            '43312487',
            '44237504',
            '73019821',
            '39755662',
            '94831185',
            '54426329',
            '98052938',
            '92282485',
            '14028769',
            '81769802',
            '95879618',
            '48496562',
            '55191306',
            '98810735',
            '78020072',
            '14077577',
            '87316744',
            '43669022',
            '75597581',
            '97534508',
            '84909176',
            '90141506',
            '30620029',
            '95014787',
            '18601930',
            '75561324',
            '50225800',
            '65845250',
            '16900923',
            '78720081',
            '97632153',
            '56328577',
            '67312125',
            '55398682',
            '48045707',
            '80161829',
            '65357703',
            '42621877',
            '66879850',
            '11276594',
            '93207916',
            '86794866',
            '80351112',
            '65465873',
            '76749170',
            '29262027',
            '32166534',
            '90816647',
            '90287554',
            '95978276',
            '39938652',
            '17186573',
            '81250392',
            '33474644',
            '91534160',
            '33550851',
            '42094819',
            '11350848',
            '83805025',
            '27094263',
            '84677685',
            '71115007',
            '54207608',
            '45584153',
            '58006694',
            '22783386',
            '41464383',
            '95870266',
            '87459003',
            '38757629',
            '35373596',
            '42737139',
            '77256286',
            '50925734',
            '72975026',
            '86909724',
            '82801976',
            '97079775',
            '77107614',
            '40431349',
            '23322761',
            '42632641',
            '28460514',
            '86815748',
            '16738029',
            '42318657',
            '60421081',
            '93269794',
            '68510942',
            '43058478',
            '40157643',
            '28636836',
            '43491755',
            '42726251',
            '84641847',
            '81379701',
            '38307208',
            '47203521',
            '79512262',
            '32575714',
            '38454127',
            '14751632',
            '65888150',
            '45870046',
            '44433144',
            '85535777',
            '98234181',
            '38834148',
            '80796179',
            '89999692',
            '86434193',
            '90077139',
            '94267768',
            '38349460',
            '25856072',
            '37516601',
            '51637766',
            '75531964',
            '64682250',
            '94588707',
            '11081795',
            '12090127',
            '73824723',
            '93853894',
            '98235202',
            '65108071',
            '81297932',
            '66476717',
            '44135121',
            '83959629',
            '77301184',
            '51161377',
            '61487945',
            '67659114',
            '52763641',
            '37657179',
            '24170511',
            '91547152',
            '56234467',
            '32755046',
            '64472592',
            '53795364',
            '82914799',
            '25727443',
            '68405330',
            '62028193',
            '24950452',
            '85305386',
            '98203980',
            '68768742',
            '77553353',
            '65944633',
            '84036746',
            '59496909',
            '88170416',
            '78600068',
            '43382093',
            '88012866',
            '12988519',
            '63456711',
            '90945115',
            '90258878',
            '83312861',
            '86696544',
            '26841579',
            '14113451',
            '96314731',
            '40427860',
            '13392435',
            '27815516',
            '35513513',
            '71541501',
            '32287577',
            '88036216',
            '55674832',
            '85877325',
            '98379040',
            '68397961',
            '73064111',
            '17268304',
            '28230562',
            '40039278',
            '31696189',
            '72229349',
            '58940697',
            '86103489',
            '87454116',
            '29693164',
            '54034040',
            '74873047',
            '45832396',
            '55771427',
            '70257530',
            '86156203',
            '49485850',
            '40965230',
            '68589750',
            '69097270',
            '35402268',
            '82564769',
            '50512495',
            '93847637',
            '69132445',
            '58981217',
            '14438362',
            '89720755',
            '38789583',
            '42292836',
            '94111574',
            '29108220',
            '32830648',
            '91826208',
            '50553810',
            '55189881',
            '82255249',
            '38611089',
            '47478547',
            '87577204',
            '89861703',
            '57235359',
            '79645687',
            '60086725',
            '65217270',
            '26328203',
            '31244771',
            '90666391',
            '76046592',
            '72555114',
            '46958796',
            '20279266',
            '63492654',
            '78028730',
            '48127017',
            '64472889',
            '32408802',
            '52172229',
            '65362548',
            '30552401',
            '72236429',
            '47600827',
            '46536051',
            '89880713',
            '11927969',
            '69682078',
            '26423893',
            '52722434',
            '94066768',
            '73159947',
            '57241253',
            '32772737',
            '86135196',
            '62630959',
            '53020378',
            '68958346',
            '34377377',
            '12003883',
            '51180426',
            '80471466',
            '25298303',
            '19784174',
            '21950557',
            '39355400',
            '53948157',
            '66181071',
            '93175824',
            '35963135',
            '89908566',
            '41299089',
            '56448104',
            '64496826',
            '80228221',
            '53815023',
            '38117360',
            '33366225',
            '61150795',
            '80039279',
            '63524833',
            '97018832',
            '98483857',
            '92507491',
            '75472319',
            '54128092',
            '25699768',
            '48826565',
            '16936097',
            '14174177',
            '17460871',
            '99385323',
            '49636922',
            '93432387',
            '48812530',
            '72269233',
            '18239629',
            '18103504',
            '92352114',
            '40545851',
            '66611377',
            '49404417',
            '62203916',
            '10125067',
            '55446984',
            '14979585',
            '93464810',
            '43831672',
            '55842195',
            '48033097',
            '24388939',
            '61117228',
            '89467072',
            '66308148',
            '45864002',
            '15574084',
            '95415399',
            '80539932',
            '91134801',
            '59498184',
            '35436725',
            '21155956',
            '86174084',
            '77655054',
            '90509550',
            '58280134',
            '96986545',
            '60889554',
            '14357752',
            '31108553',
            '91253114',
            '47093038',
            '79824215',
            '25724665',
            '47820442',
            '32677398',
            '92293347',
            '27362401',
            '61221880',
            '17445574',
            '53608643',
            '80549708',
            '77180051',
            '81317973',
            '35149234',
            '73589078',
            '67665962',
            '89981559',
            '12142052',
            '89708612',
            '21266820',
            '45562049',
            '89611720',
            '69318809',
            '73540060',
            '41688088',
            '67628451',
            '83401687',
            '56885283',
            '89002582',
            '88040353',
            '88293887',
            '54134131',
            '12780384',
            '68127073',
            '50910122',
            '86544885',
            '24219916',
            '56060951',
            '48226062',
            '77232831',
            '68998916',
            '76895407',
            '18007839',
            '56921146',
            '39727112',
            '21519210',
            '75798100',
            '37857389',
            '74834761',
            '98120239',
            '87554207',
            '46402820',
            '13300623',
            '69327021',
            '91366907',
            '25817833',
            '89983219',
            '55545599',
            '13800014',
            '79395205',
            '95692984',
            '69880597',
            '50939818',
            '46035830',
            '72879174',
            '21875296',
            '37697466',
            '44488940',
            '26615339',
            '60630106',
            '94059098',
            '91384003',
            '74463040',
            '99682166',
            '94490484',
            '37521769',
            '82933011',
            '47081502',
            '90042555',
            '93177776',
            '70342343',
            '80402154',
            '18808166',
            '69180488',
            '38725216',
            '52956175',
            '79907106',
            '56381339',
            '24249085',
            '69153988',
            '59406730',
            '42694710',
            '73271804',
            '23632440',
            '76166794',
            '59998621',
            '87812916',
            '33719425',
            '84654316',
            '87584679',
            '51780764',
            '64470979',
            '91077210',
            '93709241',
            '34612173',
            '65975146',
            '96417094',
            '97271626',
            '19730972',
            '31820541',
            '55597439',
            '62372169',
            '80645865',
            '85560924',
            '89788667',
        ]

        for id in ids:
            enrollment = Enrollment.objects.filter(assigned_identifier=id).first()

            if enrollment is not None:
                context = {}

                raw_identifier = enrollment.current_raw_identifier()

                request_email_subject = render_to_string('reminders/email_final_uninstall_subject.txt', context=context)
                request_email_txt = render_to_string('reminders/email_final_uninstall_body.txt', context=context)

                print('SEND to %s' % raw_identifier)

                request_email_html = render_to_string('reminders/email_final_uninstall_body.html', context=context)

                message = EmailMultiAlternatives(request_email_subject, request_email_txt, settings.AUTOMATED_EMAIL_FROM_ADDRESS, [raw_identifier])
                message.attach_alternative(request_email_html, 'text/html')
                message.send()
